.\" Copyright (c) 2005  Ilya Mezhirov
.\" Copyright (c) 2009  Alexey Kryukov
.\" 
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\" 
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\" 
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\" 
.\" You should have received a copy of the GNU General Public
.\" License along with this manual. Otherwise check the web site
.\" of the Free Software Foundation at http://www.fsf.org.
.\" 
.TH "MINIDJVU" "1" "July 2009" "minidjvu-0.8" "minidjvu-0.8"
.SH "NAME"
minidjvu - кодирование и расшифровка монохромных DJVU-страниц

.SH "ОБЗОР"
.BI "minidjvu  [" "options" "] " "input_file" " " "output_file"

Предусмотрен также подобный синтаксис для многостраничного сжатия:
    
.BI "minidjvu  [" "options" "] " "input_files" " " "output_file"

См. ниже раздел
.B "МНОГОСТРАНИЧНОЕ КОДИРОВАНИЕ" 
где об этом сказано более подробно.

.SH "ОПИСАНИЕ"
minidjvu может кодировать и расшифровывать одностраничные монохромные
файлы DjVu.

Программа minidjvu основана на коде DjVuLibre, базовой библиотеки,
обеспечивающей поддержку формата DjVu.

Кроме монохромных файлов DjVu, minidjvu распознает форматы Windows BMP, PBM
и TIFF (с помощью библиотеки libtiff).
Как
.I исходный,
так и 
.I результирующий
файлы могут иметь формат BMP, PBM, TIFF или DjVu. Формат файла определяется
по его расширению. Исходный и результирующий файлы могут совпадать.

Если задано преобразование из DjVu в DjVu, minidjvu сначала расшифровывает,
а затем вновь кодирует изображение. При этом содержимое файла DjVu, за исключением
текстового слоя, теряется.

Преобразование одного битового изображения в другое также допустимо, но имеет
некоторый смысл только при указании параметра
.BR --smooth.

Все параметры могут предваряться как одним, так и двумя дефисами.
Это сделано для того, чтобы сделать интерфейс MiniDjvu более удобным
для пользователей DjVuLibre.

.SH "МНОГОСТРАНИЧНОЕ КОДИРОВАНИЕ"

Если задать более одного файла для обработки, minidjvu будет работать в
многостраничном режиме. По умолчанию (если не задан параметр
.BR --indirect
) сжатые страницы помещаются в составной многостраничный документ
под тем именем, которое было указано в командной строке.

Некоторые из параметров minidjvu (
.B --pages-per-dict,
.B --indirect
и
.B --report
) предназначены специально для контроля работы программы в многостраничном
режиме.

.SH "ПАРАМЕТРЫ"
.TP
.BI "-A "
.TP 
.BI "--Averaging"
Вычислять усредненные варианты представления символов, для которых обнаружено
соответствию образцу.

.TP
.BI "-a " "n"
.TP 
.BI "--aggression " "n"
Задает уровень "агрессии" для сопоставления образцов. Чем выше агрессия, тем
меньше размер файла и выше вероятность ошибочных подстановок. По умолчанию
используется значение 100. Обычно его можно с большей или меньшей уверенностью
увеличить примерно до 110. Скорее всего, даже 200 даст вполне подходящий результат,
но на это не стоит полагаться.

Фактический уровень сжатия при выборе того или иного значения этого параметра
может изменяться от версии к версии. Тем не менее, значение 100 всегда будет
использоваться по умолчанию.

Данный параметр автоматически активирует параметр
.BR --match.

.TP
.B "-c"
.TP 
.B "--clean"
Удалять небольшие черные пятна, которые, скорее всего, представляют собой шум.
Этот алгоритм может оказать разрушительное действие на полутоновые картинки,
поэтому его следует применять с осторожностью.

Данный параметр активируется при указании
.BR "--lossy".

.TP 
.BI "-d " "n"
.TP 
.BI "--dpi " "n"
Указать разрешение изображения в точках на дюйм. Разрешение оказывает
влияние на работу некоторых алгоритмов, а при записи файлов DjVu
и BMP (поддержка формата TIFF должна быть добавлена в будущем) сохраняется
в них.

.TP
.B "-e"
.TP 
.B "--erosion"
Пожертвовать качеством изображения для того, чтобы выиграть 5-10% объема файла.
Одиночное применение эрозии практически незаметно, но 10 таких случаев в одной
строке могут сильно испортить изображение, причем, к сожалению, это всё равно
не даст слишком большого выигрыша в размере. Бонус за эрозию начисляется при
сопоставлении образцов.

Использование эрозии не имеет смысла, если вывод осуществляется не в формат
DjVu.

Данный параметр активируется при указании
.BR "--lossy".

.TP
.B "-i"
.TP 
.B "--indirect"

Этот параметр может использоваться в многостраничном режиме: его указание
заставляет minidjvu создавать на выходе документ
.I DjVu indirect.
Такие документы состоят из индексного файла, некоторого количества
одностраничных документов (по одному на каждое изображение, указанное
на входе), а также файлов, содержащих разделяемые словари. Обратите
внимание, что индексному файлу присваивается имя, указанное в командной
строке для результирующего документа, в то время как отдельные страницы
сохраняются под именами исходных изображений с заменой расширения на djvu.

Данный режим может быть полезен для больших документов, которые планируется
разместить на Web-сервере, а также если планируется последующая обработка
созданных файлов (например, с целью добавления фоновых изображений).
В последнем случае вы можете затем воспользоваться утилитой
.B djvmcvt
из поставки DjVuLibre, чтобы сконвертировать документ в формат
.I DjVu bundled.

.TP 
.B "-l"
.TP 
.B "--lossy"
Активировать все параметры, отвечающие за сжатие с потерями. Это равнозначно
указанию
.BR --Averaging
.BR --clean
.BR --erosion
.BR --match
.BR --smooth.


.TP
.B "-m"
.TP 
.B "--match"
Запустить сопоставление образцов. Это основной метод, служащий для
уменьшения размера файла, но он может привести к проблемам из-за
ошибок подстановки. Используйте параметр
.BR --aggression,
чтобы регулировать соотношение между размером файла и возможностью
возникновения ошибок.

Данный параметр активируется при указании
.BR "--lossy"
или
.BR "--aggression".

.TP 
.B "-n"
.TP 
.B "--no-prototypes"
Отключить поиск прототипов. Это позволяет ускорить процесс сжатия без
потерь, но значительно увеличивает размер создаваемых файлов.

.TP 
.B "-p"
.TP 
.B "--pages-per-dict"
Указывает, сколько страниц следует сжимать за один проход. Значение по
умолчанию - 10. При указании значения 0 (
.BR "-p 0"
) minidjvu попытается обработать все страницы сразу, однако следует иметь
в виду, что такая операция может потребовать очень много памяти, особенно
на больших по объему книгах.

.TP 
.B "-r"
.TP 
.B "--report"
Выводить подробные сообщения о ходе обработки каждой страницы в многостраничном
режиме. Это полезно только для того, чтобы скрасить долгое ожидание в процессе
сжатия книги.


.TP 
.B "-s"
.TP 
.B "--smooth"
Отключить некоторые пиксели, которые, по всей вероятности, представляют
собой шум. Это позволяет выиграть около 5% размера файла. Внешний вид
изображения слегка улучшается, но это малозаметно.

В текущей версии алгоритм обработки является примитивным и удаляет только
те черные пиксели, которые окружены белыми с трех или четырех сторон.
Эффект, скорее всего, окажется незаметным.

Данный параметр активируется при указании
.BR "--lossy".

.TP 
.B "-v"
.TP 
.B "--verbose"
Выводить сообщения о разных стадиях обработки. Они не особенно полезны,
но не лишены некоторого интереса.

.TP 
.B "-X " "ext"
.TP 
.B "--Xtension " "ext"
Задает расширение, которое minidjvu будет использовать для файлов,
содержащих разделяемые словари (начальную точку указывать не нужно).
Значение по умолчанию "iff".

.TP 
.B "-w"
.TP 
.B "--warnings"
Не подавлять предупреждения библиотеки libtiff. По умолчанию такое подавление
включено. Дело в том, что под Windows стандартный обработчик предупреждений
TIFF выводит их в виде диалогового окна с сообщением, что, конечно, неприемлемо
при обработке в пакетном режиме.

.SH ОШИБКИ

Многостраничное кодирование работает неправильно, если страницы имеют разные
разрешения.
